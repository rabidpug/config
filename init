#!/bin/sh
os=$(lsb_release -is)
cp -asfT "$HOME/.dotfiles/.config" "$HOME/.config"
if ([ "$os" = "Ubuntu" ] || [ "$os" = "Debian" ]) && [ -z "$(which fish)" ]; then
  echo installing fish...
  sudo apt -qq update
  sudo apt -qq install fish hub thefuck fzf jq unzip tmux -y
fi
if [ -z "$(which exa)" ]; then
  echo installing exa...
  sh "$HOME/.dotfiles/install_exa.sh"
fi
if [ -z "$(which gitmux)" ]; then
  sh "$HOME/.dotfiles/install_gitmux.sh"
fi
if [ ! -f "$HOME/.tmux.conf" ]; then
  echo 'source-file "$HOME/.config/tmux/tmux.conf"' > "$HOME/.tmux.conf"
fi

wf=$(which fish)
fp="${wf:-/usr/local/bin/fish}"
if [ -z "$(grep fish /etc/shells)" ]; then
  echo $fp | sudo tee -a /etc/shells
fi

if [ ! -d "$HOME/.local/share/omf" ]; then
  {
    curl https://raw.githubusercontent.com/oh-my-fish/oh-my-fish/master/bin/install | fish
  } &>/dev/null
fi
DFD=$HOME/.dotfiles

sudo ln -sf "$DFD/update_dotfiles" /usr/local/bin/update_dotfiles

sudo ln -sf "$DFD/update_dotfiles.service" /etc/systemd/system/update_dotfiles.service

sudo ln -sf "$DFD/update_dotfiles.timer" /etc/systemd/system/update_dotfiles.timer

sudo systemctl daemon-reload

sudo systemctl enable --now update_dotfiles.timer

echo run sudo chsh m -s "$fp"
exec bash
